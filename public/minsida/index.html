<!DOCTYPE html>
<html lang="is">
<head>
  <meta charset="UTF-8" />
  <title>MÃ­n sÃ­Ã°a - FjÃ¶rlistinn - FjÃ¶rlistinn</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="description" content="MÃ¦tingarkerfi fyrir fÃ©lagsmiÃ°stÃ¶Ã°var ReykjanesbÃ¦jar" />
  <meta name="theme-color" content="#8B5CF6" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="FjÃ¶rlistinn" />
  
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/svg+xml" href="/assets/icons/icon.svg" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <!-- Shared CSS -->
  <link rel="stylesheet" href="/css/shared/base.css">
  <link rel="stylesheet" href="/css/shared/buttons.css">
  <link rel="stylesheet" href="/css/shared/forms.css">
  <link rel="stylesheet" href="/css/shared/cards.css">
  <link rel="stylesheet" href="/css/shared/loading.css">
  <link rel="stylesheet" href="/css/shared/modals.css">
  
  <!-- Component CSS -->
  <link rel="stylesheet" href="/css/components/login.css">
  <link rel="stylesheet" href="/css/components/header.css">
  <link rel="stylesheet" href="/css/components/tabs.css">
  
  
</head>
<body>
  

<link rel="stylesheet" href="/css/pages/nemandi.css">

<div class="container">
  
  <div class="loading" id="minsidaLoading">
    <div class="loading-spinner"></div>
    <p>SÃ¦ki upplÃ½singar...</p>
  </div>

  
  <div id="minsidaContent" style="display: none;">
    
    <div class="card" style="text-align: center; margin-bottom: 24px;">
      <h1 id="minsidaNafn" style="font-size: 1.75rem; margin-bottom: 8px;">-</h1>
      <p style="color: var(--color-text-muted);" id="minsidaInfo">-</p>
    </div>

    
    <div class="gamification-card">
      <div class="gamification-title" id="minsidaTitle">ğŸ† NÃ½liÃ°i</div>
      <div class="gamification-stats">
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaTotal">0</div>
          <div class="gamification-stat-label">MÃ¦tingar</div>
        </div>
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaStreak">0 ğŸ”¥</div>
          <div class="gamification-stat-label">Vikur Ã­ rÃ¶Ã°</div>
        </div>
        <div class="gamification-stat">
          <div class="gamification-stat-value" id="minsidaRank">-</div>
          <div class="gamification-stat-label">SÃ¦ti</div>
        </div>
      </div>
    </div>

    
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ… Afrek</div>
      <div class="achievements-row" id="minsidaAchievements">
        <p style="color: var(--color-text-muted);">Engin afrek enn</p>
      </div>
    </div>

    
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ“‹ SÃ­Ã°ustu mÃ¦tingar</div>
      <div id="minsidaHistory">
        <p style="color: var(--color-text-muted);">Engar mÃ¦tingar</p>
      </div>
    </div>

    
    <div class="card" style="margin-top: 20px;">
      <div class="section-title">ğŸ“Š MÃ¦ting eftir mÃ¡nuÃ°um</div>
      <div class="bar-chart" id="minsidaMonthChart"></div>
    </div>

    
    <button class="back-btn" onclick="goBack()" style="margin-top: 24px;">
      â† Til baka
    </button>
  </div>

  
  <div id="minsidaError" style="display: none; text-align: center; padding: 40px;">
    <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ˜•</div>
    <h2>Villa kom upp</h2>
    <p style="color: var(--color-text-muted);">Gat ekki sÃ³tt upplÃ½singar</p>
    <button class="btn" onclick="window.location.reload()" style="margin-top: 16px;">Reyna aftur</button>
  </div>
</div>

<script>
// Get student ID from URL
const urlParams = new URLSearchParams(window.location.search);
const studentId = urlParams.get('id');

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
  if (!studentId) {
    showError();
    return;
  }

  // Set center color from URL if provided
  initCenterFromUrl();

  try {
    const stats = await apiGet('studentStats', { student_id: studentId });
    
    if (stats.status === 'error') {
      showError();
      return;
    }

    renderMinsida(stats);
  } catch (err) {
    console.error('Villa:', err);
    showError();
  }
});

function renderMinsida(data) {
  document.getElementById('minsidaLoading').style.display = 'none';
  document.getElementById('minsidaContent').style.display = 'block';

  // Basic info
  document.getElementById('minsidaNafn').textContent = data.nafn || '-';
  document.getElementById('minsidaInfo').textContent = `${data.skoli || ''} â€¢ ${data.bekkur || ''}. bekkur`;

  // Stats
  document.getElementById('minsidaTitle').textContent = `ğŸ† ${data.title || 'NÃ½liÃ°i'}`;
  document.getElementById('minsidaTotal').textContent = data.totalCount || 0;
  document.getElementById('minsidaStreak').textContent = `${data.streakWeeks || 0} ğŸ”¥`;
  document.getElementById('minsidaRank').textContent = data.rank ? `#${data.rank}` : '-';

  // Achievements
  const achievementsEl = document.getElementById('minsidaAchievements');
  if (data.achievements && data.achievements.length > 0) {
    achievementsEl.innerHTML = data.achievements.map(a => `
      <div class="achievement-badge">
        <span>${a.emoji || 'ğŸ…'}</span>
        <span>${a.name || a}</span>
      </div>
    `).join('');
  }

  // History
  const historyEl = document.getElementById('minsidaHistory');
  if (data.recentAttendance && data.recentAttendance.length > 0) {
    historyEl.innerHTML = data.recentAttendance.slice(0, 10).map(a => `
      <div class="attendance-item" style="padding: 12px 0; border-bottom: 1px solid var(--color-border);">
        <div style="font-weight: 500;">${formatFullDate(a.date)}</div>
        <div style="font-size: 0.85rem; color: var(--color-text-muted);">${a.center_name || a.center_id} â€¢ ${a.dagskrarlid || ''}</div>
      </div>
    `).join('');
  }

  // Monthly chart
  if (data.byMonth) {
    const monthData = Object.entries(data.byMonth).map(([month, count]) => ({
      label: month,
      value: count
    }));
    renderWeeklyChart('minsidaMonthChart', monthData);
  }
}

function showError() {
  document.getElementById('minsidaLoading').style.display = 'none';
  document.getElementById('minsidaError').style.display = 'block';
}

function goBack() {
  if (document.referrer) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}
</script>

  
  <!-- Shared JS -->
  <script src="/js/shared/config.js"></script>
  <script src="/js/shared/api.js"></script>
  <script src="/js/shared/utils.js"></script>
  <script src="/js/shared/state.js"></script>
  <script src="/js/shared/auth.js"></script>
  
  
  
  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('FjÃ¶rlistinn SW registered'))
          .catch(err => console.log('FjÃ¶rlistinn SW failed:', err));
      });
    }
  </script>
</body>
</html>
